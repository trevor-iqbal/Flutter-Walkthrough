import 'dart:convert';
import 'package:flutter_test/flutter_test.dart';
import 'package:flutter_walkthrough/src/article_parsing.dart';
import 'package:http/http.dart' as http;

void main(){
  test("parses topstories.json", (){
      const jsonString = "[ 19080875, 19082880, 19078281, 19078571, 19081004, 19082943, 19077913, 19082944, 19066904, 19076745, 19079140, 19082265, 19077548, 19077648, 19077354, 19069651, 19069221, 19080006, 19083208, 19083121, 19077700, 19076486, 19077891, 19076213, 19060861, 19075599, 19075953, 19080742, 19076293, 19079343, 19078098, 19072467, 19079526, 19082626, 19080097, 19080989, 19070298, 19078385, 19082432, 19078960, 19080923, 19076863, 19080760, 19079696, 19080067, 19075490, 19078896, 19076882, 19079955, 19076360, 19078518, 19080105, 19078235, 19077043, 19070335, 19076713, 19079860, 19077776, 19077126, 19081291, 19083265, 19079770, 19076970, 19075003, 19082095, 19083204, 19079139, 19075812, 19075992, 19074299, 19082807, 19072850, 19083006, 19075901, 19082859, 19076607, 19075766, 19060135, 19069587, 19083054, 19079503, 19083036, 19081761, 19062595, 19065885, 19067565, 19082694, 19075176, 19081694, 19074170, 19075588, 19078796, 19082981, 19063727, 19075267, 19082354, 19075325, 19082299, 19066276, 19078368, 19062501, 19074512, 19080271, 19078125, 19071449, 19069312, 19076278, 19065722, 19072433, 19077235, 19069047, 19076131, 19070448, 19075396, 19074886, 19076528, 19081845, 19061491, 19072769, 19068188, 19077432, 19081967, 19076204, 19073538, 19072700, 19080191, 19081681, 19076355, 19082705, 19074089, 19070632, 19072941, 19072078, 19080040, 19076502, 19079550, 19070114, 19077561, 19082303, 19068304, 19073433, 19081499, 19067302, 19070547, 19075984, 19080904, 19071598, 19075758, 19073811, 19081223, 19068359, 19072341, 19072680, 19081136, 19071751, 19069560, 19072933, 19068465, 19082366, 19071392, 19077831, 19069440, 19072600, 19071835, 19082315, 19078171, 19081225, 19075777, 19069553, 19068865, 19080007, 19075633, 19081012, 19068017, 19077033, 19069042, 19060764, 19082133, 19067190, 19070511, 19081508, 19075009, 19078833, 19069365, 19073218, 19076608, 19062667, 19078216, 19058702, 19079881, 19080520, 19082923, 19062304, 19063053, 19071604, 19081117, 19073851, 19069671, 19063540, 19070295, 19069450, 19075362, 19073222, 19077168, 19055166, 19080129, 19072914, 19055994, 19066521, 19050927, 19073295, 19075581, 19070438, 19081577, 19061303, 19068008, 19072980, 19081523, 19052688, 19061662, 19069018, 19072284, 19054466, 19064791, 19072186, 19075264, 19072307, 19073281, 19079231, 19077259, 19062319, 19081231, 19049834, 19050509, 19070316, 19073273, 19061483, 19080100, 19075057, 19060502, 19066204, 19055119, 19081060, 19081008, 19072275, 19050955, 19062414, 19080965, 19051914, 19066366, 19057673, 19081886, 19070733, 19077243, 19052830, 19067027, 19047384, 19071221, 19064069, 19065682, 19060487, 19065116, 19052587, 19057007, 19056808, 19060394, 19081005, 19071693, 19080516, 19060699, 19048204, 19052817, 19062351, 19051435, 19054440, 19062671, 19071944, 19070715, 19071050, 19065859, 19069856, 19070172, 19071646, 19069171, 19078408, 19066951, 19049479, 19060608, 19059125, 19061690, 19069349, 19080673, 19075081, 19057848, 19062514, 19068665, 19071192, 19068269, 19059805, 19076578, 19061034, 19072296, 19067252, 19060256, 19046468, 19077718, 19063977, 19062285, 19071779, 19055312, 19073771, 19066203, 19047530, 19052062, 19052011, 19076955, 19054558, 19066033, 19050998, 19073181, 19075218, 19048849, 19056253, 19057604, 19063829, 19057331, 19062544, 19078320, 19054358, 19061656, 19046259, 19062349, 19060748, 19046475, 19057277, 19075702, 19061460, 19060678, 19072093, 19071054, 19071028, 19063711, 19057643, 19069526, 19063064, 19072420, 19072419, 19068506, 19046826, 19046952, 19074694, 19065814, 19062407, 19071226, 19062042, 19077344, 19048946, 19065236, 19060043, 19050681, 19062707, 19071805, 19046461, 19075611, 19046238, 19069566, 19070131, 19062261, 19059674, 19067661, 19049448, 19076856, 19075475, 19057623, 19057683, 19070221, 19068089, 19058382, 19066122, 19074720, 19065461, 19070754, 19058713, 19061745, 19047096, 19074840, 19070747, 19060407, 19062737, 19046108, 19076359, 19062674, 19056656, 19054501, 19047503, 19060510, 19065635, 19054398, 19059028, 19059118, 19051415, 19069544, 19071769, 19070593, 19065791, 19060069, 19048126, 19050073, 19055165, 19075706, 19061113, 19074716, 19058971, 19059719, 19058108, 19069080, 19062253, 19073950, 19063548, 19053275, 19070794, 19068452, 19072808, 19047447, 19072329, 19060523, 19075299, 19060302, 19064382, 19054932, 19060491, 19067164, 19069320, 19064316, 19056805, 19062638, 19076942, 19048218, 19057146, 19071357, 19054150, 19059120, 19051604, 19065259, 19051541, 19063446, 19054544, 19069995, 19073430, 19050482, 19061135, 19060985, 19053724, 19045578, 19048976, 19048108, 19062531, 19056911, 19051866, 19071755, 19070073, 19050102, 19061679, 19046289, 19074598, 19074575, 19046131, 19048787, 19055164, 19054136, 19047620, 19047609, 19066864, 19062791, 19076994, 19066622, 19066610, 19074173, 19070532, 19064093, 19060433, 19051205, 19070126, 19067270, 19050738, 19057742, 19071345, 19061871, 19065358, 19072735, 19067077, 19066088, 19062433, 19061344, 19070789, 19050807, 19057514, 19064257, 19056698, 19049384 ]";
  expect(parseTopStoriesTestCase(jsonString).first, 19080875);
  });
  test("parses item.json", (){
      const jsonString = """{
          "by": "peter_d_sherman",
          "descendants": 328,
          "id": 19080875,
          "kids": [19083543,19081317,19081408,19081431,19081304,19082083,19083919,19081725,19081272,19081323,19081455,19081868,19081273,19081361,19082393,
          19082320,19081970,19083918,19081533,19083862,19082206,19081936,19083570,19082749,19082052,19082691,19081355,19082106,19082934,19081766,
          19083636,19084494,19081530,19082651,19083080,19081471,19082093,19083902,19083201,19081513,19081306,19082449,19083617,19082898,19082236,
          19080949,19081578,19081827],
          "score": 637,
          "time": 1549316208,
          "title": "“Lambda and serverless is one of the worst forms of proprietary lock-in” (2017)",
          "type": "story",
          "url": "https://www.theregister.co.uk/2017/11/06/coreos_kubernetes_v_world/"
          }""";
  expect(parseArticleTestCase(jsonString).by, "peter_d_sherman");
  });
  test("parses item.json over a network", () async{
    final url = "https://hacker-news.firebaseio.com/v0/topstories.json";
    final res = await http.get(url);
    if(res.statusCode == 200){
      final idList = json.decode(res.body);
      if(idList.isNotEmpty){
        final storyUrl = 'https://hacker-news.firebaseio.com/v0/item/${idList.first}.json';
        final storyRes = await http.get(storyUrl);
        if(res.statusCode == 200){
          expect(parseArticleTestCase(storyRes.body).by, "vetelko");
        }
      }
    }
  });
}